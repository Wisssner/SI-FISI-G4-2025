<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Experto del Reino Fungi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            margin: 10px 0;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .control-group label {
            margin-bottom: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        select, button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:hover, button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .chart-container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow-x: auto;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            transform: scale(1.1);
        }
        
        .node rect {
            stroke-width: 2;
            rx: 8;
            ry: 8;
        }
        
        .node text {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .link {
            fill: none;
            stroke-width: 2;
            opacity: 0.6;
        }
        
        .filum { fill: #ff6b6b; stroke: #e55656; }
        .clase { fill: #4ecdc4; stroke: #45b7b8; }
        .orden { fill: #45b7d1; stroke: #3d9bc0; }
        .familia { fill: #96ceb4; stroke: #85c1a3; }
        .genero { fill: #feca57; stroke: #f9ca24; }
        .especie { fill: #ff9ff3; stroke: #ee5a6f; }
        
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            display: none;
            z-index: 1000;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.3);
        }
        
        .stats {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üçÑ Sistema Experto del Reino Fungi</h1>
        <p>Visualizaci√≥n Interactiva de la Taxonom√≠a F√∫ngica</p>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label>Filtrar por nivel:</label>
            <select id="levelFilter">
                <option value="all">Todos los niveles</option>
                <option value="filum">Solo Filos</option>
                <option value="clase">Hasta Clases</option>
                <option value="orden">Hasta √ìrdenes</option>
                <option value="familia">Hasta Familias</option>
                <option value="genero">Hasta G√©neros</option>
                <option value="especie">Todos (Especies)</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Enfoque:</label>
            <select id="focusFilter">
                <option value="all">Todos</option>
                <option value="comestible">Comestibles</option>
                <option value="toxico">T√≥xicos</option>
                <option value="medicinal">Medicinales</option>
                <option value="industrial">Industriales</option>
            </select>
        </div>
        
        <button onclick="resetView()">Restablecer Vista</button>
        <button onclick="expandAll()">Expandir Todo</button>
    </div>
    
    <div class="chart-container">
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color filum"></div>
                <span>Filo</span>
            </div>
            <div class="legend-item">
                <div class="legend-color clase"></div>
                <span>Clase</span>
            </div>
            <div class="legend-item">
                <div class="legend-color orden"></div>
                <span>Orden</span>
            </div>
            <div class="legend-item">
                <div class="legend-color familia"></div>
                <span>Familia</span>
            </div>
            <div class="legend-item">
                <div class="legend-color genero"></div>
                <span>G√©nero</span>
            </div>
            <div class="legend-item">
                <div class="legend-color especie"></div>
                <span>Especie</span>
            </div>
        </div>
        <svg id="taxonomy-chart"></svg>
        <div class="stats" id="stats"></div>
    </div>
    
    <div class="info-panel" id="infoPanel">
        <div id="panelContent"></div>
    </div>

    <script>
        // Datos del sistema experto
        const fungiData = {
            reino: {
                name: "Reino Fungi",
                type: "reino",
                children: [
                    {
                        name: "Ascomycota",
                        type: "filum",
                        description: "Hongos de saco",
                        children: [
                            {
                                name: "Saccharomycetes",
                                type: "clase",
                                children: [
                                    {
                                        name: "Saccharomycetales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Saccharomycetaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Saccharomyces",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "S. cerevisiae",
                                                                type: "especie",
                                                                properties: ["industrial", "fermentacion"],
                                                                description: "Levadura del pan y cerveza"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                name: "Eurotiomycetes",
                                type: "clase",
                                children: [
                                    {
                                        name: "Eurotiales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Aspergillaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Aspergillus",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "A. niger",
                                                                type: "especie",
                                                                properties: ["industrial"],
                                                                description: "Producci√≥n de √°cido c√≠trico"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                name: "Trichocomaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Penicillium",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "P. chrysogenum",
                                                                type: "especie",
                                                                properties: ["industrial", "antibioticos"],
                                                                description: "Producci√≥n de penicilina"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                name: "Sordariomycetes",
                                type: "clase",
                                children: [
                                    {
                                        name: "Hypocreales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Hypocreaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Trichoderma",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "T. harzianum",
                                                                type: "especie",
                                                                properties: ["industrial", "biocontrol"],
                                                                description: "Control biol√≥gico"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                name: "Nectriaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Fusarium",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "F. sp.",
                                                                type: "especie",
                                                                properties: ["patogeno"],
                                                                description: "Pat√≥geno de plantas"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        name: "Basidiomycota",
                        type: "filum",
                        description: "Hongos de basidio",
                        children: [
                            {
                                name: "Agaricomycetes",
                                type: "clase",
                                children: [
                                    {
                                        name: "Agaricales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Agaricaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Agaricus",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "A. bisporus",
                                                                type: "especie",
                                                                properties: ["comestible"],
                                                                description: "Champi√±√≥n com√∫n"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                name: "Pleurotaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Pleurotus",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "P. ostreatus",
                                                                type: "especie",
                                                                properties: ["comestible"],
                                                                description: "Seta ostra"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                name: "Amanitaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Amanita",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "A. phalloides",
                                                                type: "especie",
                                                                properties: ["toxico", "mortal"],
                                                                description: "Oronja verde (mortal)"
                                                            },
                                                            {
                                                                name: "A. ocreata",
                                                                type: "especie",
                                                                properties: ["toxico", "mortal"],
                                                                description: "√Ångel destructor"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        name: "Boletales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Boletaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Boletus",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "B. edulis",
                                                                type: "especie",
                                                                properties: ["comestible"],
                                                                description: "Boleto comestible"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        name: "Cantharellales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Cantharellaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Cantharellus",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "C. cibarius",
                                                                type: "especie",
                                                                properties: ["comestible"],
                                                                description: "Rebozuelo"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        name: "Polyporales",
                                        type: "orden",
                                        children: [
                                            {
                                                name: "Ganodermataceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Ganoderma",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "G. lucidum",
                                                                type: "especie",
                                                                properties: ["medicinal", "antitumoral"],
                                                                description: "Reishi"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                name: "Polyporaceae",
                                                type: "familia",
                                                children: [
                                                    {
                                                        name: "Trametes",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "T. versicolor",
                                                                type: "especie",
                                                                properties: ["medicinal", "antitumoral"],
                                                                description: "Cola de pavo"
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        name: "Hericium",
                                                        type: "genero",
                                                        children: [
                                                            {
                                                                name: "H. erinaceus",
                                                                type: "especie",
                                                                properties: ["medicinal", "neuroprotector"],
                                                                description: "Melena de le√≥n"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        let svg, g, root;
        let currentData = fungiData.reino;

        function initializeChart() {
            const container = document.querySelector('.chart-container');
            const width = Math.max(1200, container.clientWidth - 40);
            const height = 800;

            svg = d3.select("#taxonomy-chart")
                .attr("width", width)
                .attr("height", height);

            g = svg.append("g");

            root = d3.hierarchy(currentData);
            updateChart();
        }

        function updateChart() {
            const width = +svg.attr("width");
            const height = +svg.attr("height");

            // Crear el layout de √°rbol
            const treeLayout = d3.tree()
                .size([width - 100, height - 100]);

            treeLayout(root);

            // Limpiar contenido anterior
            g.selectAll("*").remove();

            // Crear grupo principal centrado
            const mainGroup = g.append("g")
                .attr("transform", "translate(50, 50)");

            // Crear enlaces
            const links = mainGroup.selectAll(".link")
                .data(root.links())
                .enter().append("path")
                .attr("class", "link")
                .attr("d", d3.linkVertical()
                    .x(d => d.x)
                    .y(d => d.y))
                .style("stroke", "#666");

            // Crear nodos
            const nodes = mainGroup.selectAll(".node")
                .data(root.descendants())
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x}, ${d.y})`)
                .on("click", handleNodeClick)
                .on("mouseover", showInfo)
                .on("mouseout", hideInfo);

            // A√±adir rect√°ngulos a los nodos
            nodes.append("rect")
                .attr("class", d => d.data.type)
                .attr("width", d => Math.max(80, d.data.name.length * 6))
                .attr("height", 30)
                .attr("x", d => -Math.max(40, d.data.name.length * 3))
                .attr("y", -15);

            // A√±adir texto a los nodos
            nodes.append("text")
                .text(d => d.data.name)
                .attr("dy", "0.35em")
                .style("fill", "#333");

            updateStats();
        }

        function handleNodeClick(event, d) {
            if (d.children || d._children) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                updateChart();
            }
        }

        function showInfo(event, d) {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            
            let info = `<h3>${d.data.name}</h3>`;
            info += `<p><strong>Tipo:</strong> ${d.data.type}</p>`;
            
            if (d.data.description) {
                info += `<p><strong>Descripci√≥n:</strong> ${d.data.description}</p>`;
            }
            
            if (d.data.properties) {
                info += `<p><strong>Propiedades:</strong> ${d.data.properties.join(', ')}</p>`;
            }
            
            if (d.children) {
                info += `<p><strong>Hijos:</strong> ${d.children.length}</p>`;
            }
            
            content.innerHTML = info;
            panel.style.display = 'block';
        }

        function hideInfo() {
            document.getElementById('infoPanel').style.display = 'none';
        }

        function resetView() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            updateChart();
        }

        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            updateChart();
        }

        function filterByLevel() {
            const level = document.getElementById('levelFilter').value;
            const levelMap = {
                'filum': 1,
                'clase': 2,
                'orden': 3,
                'familia': 4,
                'genero': 5,
                'especie': 6
            };

            if (level === 'all') {
                resetView();
                return;
            }

            const maxDepth = levelMap[level];
            
            root.descendants().forEach(d => {
                if (d.depth >= maxDepth) {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    }
                } else {
                    if (d._children) {
                        d.children = d._children;
                        d._children = null;
                    }
                }
            });
            
            updateChart();
        }

        function filterByFocus() {
            const focus = document.getElementById('focusFilter').value;
            
            if (focus === 'all') {
                resetView();
                return;
            }

            // Ocultar todos los nodos inicialmente
            root.descendants().forEach(d => {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                }
            });

            // Mostrar solo los nodos relevantes
            root.descendants().forEach(d => {
                if (d.data.properties && d.data.properties.includes(focus)) {
                    // Mostrar este nodo y todos sus ancestros
                    let current = d;
                    while (current.parent) {
                        if (current.parent._children) {
                            current.parent.children = current.parent._children;
                            current.parent._children = null;
                        }
                        current = current.parent;
                    }
                }
            });

            updateChart();
        }

        function updateStats() {
            const descendants = root.descendants();
            const stats = {};
            
            descendants.forEach(d => {
                if (!stats[d.data.type]) {
                    stats[d.data.type] = 0;
                }
                stats[d.data.type]++;
            });

            let statsText = "Estad√≠sticas: ";
            Object.entries(stats).forEach(([type, count]) => {
                if (type !== 'reino') {
                    statsText += `${type}: ${count} | `;
                }
            });

            document.getElementById('stats').textContent = statsText.slice(0, -3);
        }

        // Event listeners
        document.getElementById('levelFilter').addEventListener('change', filterByLevel);
        document.getElementById('focusFilter').addEventListener('change', filterByFocus);

        // Inicializar el gr√°fico
        window.addEventListener('load', initializeChart);
        window.addEventListener('resize', () => {
            setTimeout(initializeChart, 250);
        });
    </script>
</body>
</html>